<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">

    
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">

    

    <meta name="author" content="Adhy">
    <meta name="description" content="Arch Linux Installation">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BTW I use Arch"/>
<meta name="twitter:description" content="Arch Linux Installation"/>

    <meta property="og:title" content="BTW I use Arch" />
<meta property="og:description" content="Arch Linux Installation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.adhysetiawan.com/posts/arch/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-01T16:42:36+08:00" />
<meta property="article:modified_time" content="2022-11-01T16:42:36+08:00" />


    <title>
  BTW I use Arch · Adhy Setiawan
</title>

    
      <link rel="canonical" href="http://www.adhysetiawan.com/posts/arch/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css" integrity="sha256-2f3b/&#43;byfmmYXcX&#43;BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css" integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.108.0">
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto">
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Adhy Setiawan
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Writeups</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://www.adhysetiawan.com/posts/arch/">
              BTW I use Arch
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-11-01T16:42:36&#43;08:00">
                November 1, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/writeup/">writeup</a>
    </span></div>

        </div>
      </header>

      <div>
        
        <h1 id="note-this-is-a-work-in-progress">
  Note: this is a work in progress.
  <a class="heading-link" href="#note-this-is-a-work-in-progress">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h1 id="part-1-arch-installation">
  Part 1: Arch installation
  <a class="heading-link" href="#part-1-arch-installation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="0-preparation">
  0. Preparation
  <a class="heading-link" href="#0-preparation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Resize the partition using windows disk utility. Allocate some free space for arch.</p>
<h2 id="1-downloading-the-image-and-create-an-installation-media">
  1. Downloading the image and create an installation media
  <a class="heading-link" href="#1-downloading-the-image-and-create-an-installation-media">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="11-download">
  1.1. Download
  <a class="heading-link" href="#11-download">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://download.nus.edu.sg/mirror/archlinux/iso/2022.10.01/
</span></span></code></pre></div><p>Download archlinux-x86_64.iso and archlinux-x86_64.iso.sig</p>
<p>Verify the key</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>gpg --keyserver-options auto-key-retrieve --verify archlinux-x86_64.iso.sig
</span></span></code></pre></div><p>Confirm that the key fingerprint is shown at the the Developer page of arch.</p>
<h3 id="12-create-media">
  1.2. Create media
  <a class="heading-link" href="#12-create-media">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Insert USB
Get the USB device name from</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>lsblk
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo -i # cat won&#39;t work with sudo
</span></span><span style="display:flex;"><span>cat archlinux-x86_64.iso &gt; /dev/sda; sync
</span></span></code></pre></div><h2 id="2-booting-using-the-usb">
  2. Booting using the USB
  <a class="heading-link" href="#2-booting-using-the-usb">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Press F1 (Thinkpad).
Disable the secure boot and move the boot priority for usb devices
Restart</p>
<h2 id="3-installation">
  3. Installation
  <a class="heading-link" href="#3-installation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="31-setting-up-network">
  3.1. Setting up network
  <a class="heading-link" href="#31-setting-up-network">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/wpa_supplicant/wpa_supplicant.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># /etc/wpa_supplicant/wpa_supplicant.conf
</span></span><span style="display:flex;"><span>ctrl_interface=/run/wpa_supplicant
</span></span><span style="display:flex;"><span>network={
</span></span><span style="display:flex;"><span>  ssid=&#34;NUS_STU&#34;
</span></span><span style="display:flex;"><span>  scan_ssid=1
</span></span><span style="display:flex;"><span>  key_mgmt=WPA-EAP
</span></span><span style="display:flex;"><span>  eap=PEAP
</span></span><span style="display:flex;"><span>  identity=&#34;nusstu\***&#34;
</span></span><span style="display:flex;"><span>  password=&#34;***&#34;
</span></span><span style="display:flex;"><span>  phase2=&#34;autheap=MSCHAPV2&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>wpa_supplicant -B -i wlan0 /etc/wpa_supplicant/wpa_supplicant.conf
</span></span><span style="display:flex;"><span>systemctl restart iwd.service
</span></span></code></pre></div><h3 id="32-update-system-clock">
  3.2. Update system clock
  <a class="heading-link" href="#32-update-system-clock">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>timedatectl status
</span></span></code></pre></div><h3 id="33-partition-the-disks">
  3.3. Partition the disks
  <a class="heading-link" href="#33-partition-the-disks">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>After that,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>lsblk
</span></span><span style="display:flex;"><span>fdisk /dev/nvme0n1
</span></span></code></pre></div><p>Inside fdisk:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Command (m for help): n
</span></span><span style="display:flex;"><span>Paritition number (5-128, default 5): &lt;enter&gt;
</span></span><span style="display:flex;"><span>First sector (XXX-YYY, default XXX): &lt;enter&gt;
</span></span><span style="display:flex;"><span>Last sector, +/-sectors or +/-size: +8G # for swap partition
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command (m for help): t
</span></span><span style="display:flex;"><span>Paritition number (5-128, default 5): &lt;enter&gt;
</span></span><span style="display:flex;"><span>Partition type or alias (type L to list all): swap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command (m for help): n
</span></span><span style="display:flex;"><span>Paritition number (6-128, default 6): &lt;enter&gt;
</span></span><span style="display:flex;"><span>First sector (XXX-YYY, default XXX): &lt;enter&gt;
</span></span><span style="display:flex;"><span>Last sector, +/-sectors or +/-size: &lt;enter&gt; # root partition
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command (m for help): v
</span></span><span style="display:flex;"><span>Command (m for help): w
</span></span></code></pre></div><h3 id="34-format-the-parititions">
  3.4. Format the parititions
  <a class="heading-link" href="#34-format-the-parititions">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkfs.ext4 /dev/nvme0n1p6 # we set part no. 6 as our root partition
</span></span><span style="display:flex;"><span>mkswap /dev/nvme0n1p5
</span></span></code></pre></div><h3 id="35-mount-the-partitions">
  3.5. Mount the partitions
  <a class="heading-link" href="#35-mount-the-partitions">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mount /dev/nvme0n1p6 /mnt
</span></span><span style="display:flex;"><span>mount --mkdir /dev/nvme0n1p1 /mnt/boot
</span></span><span style="display:flex;"><span>swapon /dev/nvme1n1p5
</span></span></code></pre></div><h3 id="36-install-essential-packages">
  3.6. Install essential packages
  <a class="heading-link" href="#36-install-essential-packages">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacstrap -K /mnt base linux linux-firmware
</span></span></code></pre></div><p>alternatively, at this stage, we can install more</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacstrap -K /mnt base linux linux-firmware
</span></span><span style="display:flex;"><span>networkmanager vim man-db man-pages texinfo grub
</span></span><span style="display:flex;"><span>efibootmgr
</span></span></code></pre></div><h2 id="4-system-configuration">
  4. System configuration
  <a class="heading-link" href="#4-system-configuration">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span><span style="display:flex;"><span>arch-chroot /mnt
</span></span><span style="display:flex;"><span>ln -sf /usr/share/zoneinfo/Singapore /etc/localtime
</span></span><span style="display:flex;"><span>hwclock --systohc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># uncomment en_US.UTF-8 UTF-8 from /etc/locale.gen
</span></span><span style="display:flex;"><span>locale-gen
</span></span><span style="display:flex;"><span>echo &#34;LANG=en_US.UTF-8&#34; &gt;&gt; /etc/locale.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>echo &#34;thinkpad&#34; &gt; /etc/hostname
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>passwd # set up root password
</span></span></code></pre></div><h3 id="41-setup-boot-loader">
  4.1. Setup Boot loader
  <a class="heading-link" href="#41-setup-boot-loader">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S grub efibootmgr os-prober
</span></span><span style="display:flex;"><span>grub-install --target=x86_64-efi
</span></span><span style="display:flex;"><span>--efi-directory=/boot --bootloader-id=GRUB
</span></span><span style="display:flex;"><span>os-prober
</span></span><span style="display:flex;"><span>uncomment
</span></span><span style="display:flex;"><span>GRUB_DISABLE_OS_PROBER=false /etc/default/grub
</span></span><span style="display:flex;"><span>grub-mkconfig -o
</span></span><span style="display:flex;"><span>/boot/grub/grub.cfg
</span></span></code></pre></div><p>After that, reboot the system and arch is installed.</p>
<h1 id="part-2-setting-up-the-system">
  Part 2: Setting up the system
  <a class="heading-link" href="#part-2-setting-up-the-system">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="1-connecting-to-wifi">
  1. Connecting to WiFi
  <a class="heading-link" href="#1-connecting-to-wifi">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>iwctl is not installed by default; our previous attempt with wpa_supplicant does not work. But, now we have nmcli.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>nmcli device wifi list
</span></span><span style="display:flex;"><span>nmcli con add type wifi ifname wlp1s0 con-name NUS ssid NUS_STU
</span></span><span style="display:flex;"><span>nmcli con edit id NUS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># inside nmcli
</span></span><span style="display:flex;"><span>set ipv4.method auto
</span></span><span style="display:flex;"><span>set 802-1x.eap peap
</span></span><span style="display:flex;"><span>set 802-1x.phase2-auth mschapv2
</span></span><span style="display:flex;"><span>set 802-1x.identity nusstu\\e0407797
</span></span><span style="display:flex;"><span>set wifi-sec.key-mgmt wpa-eap
</span></span><span style="display:flex;"><span>set 802-1x.password ***********
</span></span><span style="display:flex;"><span>save
</span></span><span style="display:flex;"><span>activate
</span></span><span style="display:flex;"><span>exit
</span></span></code></pre></div><h2 id="2-setting-up-pacman">
  2. Setting up pacman
  <a class="heading-link" href="#2-setting-up-pacman">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>For some reason, the pacman keyring used to verify the packages were broken. The pacman keyring needs to be reinstalled.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/pacman.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># do not check the packages
</span></span><span style="display:flex;"><span>SigLevel = Never
</span></span></code></pre></div><p>After changing the config file, reinstall the keys:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S archlinux-keyring
</span></span><span style="display:flex;"><span>pacman-key --init
</span></span><span style="display:flex;"><span>pacman-key --refresh-keys
</span></span></code></pre></div><p>After that, return the config file to the default settings</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/pacman.conf
</span></span><span style="display:flex;"><span>SigLevel =
</span></span></code></pre></div><h2 id="3-setup-non-root-user-account">
  3. Setup non-root user account
  <a class="heading-link" href="#3-setup-non-root-user-account">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h2 id="4-install-window-manager">
  4. Install window manager
  <a class="heading-link" href="#4-install-window-manager">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S xf86-video-amdgpu xinit xorg awesome
</span></span><span style="display:flex;"><span>pacman -S xorg-server xorg-xinit xterm awesome
</span></span></code></pre></div><h3 id="41-start-awesome-on-login">
  4.1. Start awesome on login:
  <a class="heading-link" href="#41-start-awesome-on-login">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim .xinitrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>exec awesome
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim .zprofile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>if [ -z &#34;${DISPLAY}&#34; ] &amp;&amp; [ &#34;${XDG_VTNR}&#34; -eq 1 ]; then
</span></span><span style="display:flex;"><span>	exec startx
</span></span><span style="display:flex;"><span>fi
</span></span></code></pre></div><h3 id="42-customise-awesome">
  4.2. Customise awesome
  <a class="heading-link" href="#42-customise-awesome">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Follow the instructions from <a href="https://github.com/lcpz/awesome-copycats">awesome-copycats</a>.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    ©
    
    2022
     Adhy 
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

    </main>

    
      
      <script src="/js/coder.min.9cf2dbf9b6989ef8eae941ffb4231c26d1dc026bca38f1d19fdba50177d8a9ac.js" integrity="sha256-nPLb&#43;baYnvjq6UH/tCMcJtHcAmvKOPHRn9ulAXfYqaw="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
